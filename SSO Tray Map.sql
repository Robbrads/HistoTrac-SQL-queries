/*Main*/
select traywell.trayid,traynm, cast(case tray.lefttorightviewind when 0 then traywell.colnbr else traywell.rownbr end as integer) as rownbr,cast(case tray.lefttorightviewind when 0 then traywell.rownbr else traywell.colnbr end as integer) as colnbr,isnull(sample.samplenbr,'') as samplenbr,isnull(reagent.reagentnm,'') as reagentnm,wellcd,isnull(case patient.patienttypecd when 'Proficiency' then patient.surveynm else patient.lastnm end,'') as lastnm, isnull( case patient.patienttypecd when 'Proficiency' then patient.surveynbr else patient.firstnm  end,'') as firstnm ,cast(sample.sampledt as nvarchar)  as sampledt,isnull(tray.manufacturernm,'') as manufacturerNm,isnull(tray.lotnbr,'') as lotnbr,isnull(tray.expirationdt,'') as expirationdt,isnull(tray.traytypecd,'') as traytypecd,isnull(patient.hospitalid,'') as hospitalid,isnull(patient.ssnbr,'') as ssnbr, isnull(test.testtypecd,'') as TestTypeCd, isnull(patient.requiresDTTind,'0') as RequiresDTTInd, patient.categorycd from tray LEft Join TrayWell on TrayWell.Trayid =Tray.TrayId  left join reagent on traywell.reagentid = reagent.reagentid left join sample on traywell.sampleid = sample.sampleid  left join patient on sample.patientid = patient.patientid left join test on test.testid = traywell.testid  where traywell.trayid = tray.trayid and tray.trayid  IN  (<Current Tray>) order by rownbr,colnbr